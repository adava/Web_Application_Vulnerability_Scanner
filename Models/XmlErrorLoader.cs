using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using System.Xml;

namespace MicroFocus_Scanner
{
    class XmlErrorLoader : IErrorLoader
    {
        string XmlPath;
        string MemberTag;
        XmlDocument XDoc = null;
        public XmlErrorLoader(string xmlPath, string tag)
        {
            this.XmlPath = xmlPath;
            this.MemberTag = tag;
        }
        public XmlErrorLoader(XmlDocument xDoc, string tag)
        {
            this.XDoc = xDoc;
            this.MemberTag = tag;
        }
        public Regex[] load_errors()
        {
            List<string> rx_strs = new List<string>();
            try
            {
                if (XDoc == null)
                {
                    XmlDocument XDoc = new XmlDocument();
                    XDoc.Load(this.XmlPath);
                }
                
                XmlNodeList name = XDoc.GetElementsByTagName(this.MemberTag);
                foreach (XmlNode x in name[0])
                {
                    //Console.WriteLine(x.InnerText);
                    rx_strs.Add(x.InnerText);
                }
                Regex[] rrx = new Regex[rx_strs.Count];
                for (int i = 0; i < rx_strs.Count; i++)
                {
                    rrx[i] = new Regex(rx_strs[i]);
                }
                return rrx;
            }
            catch (Exception e)
            {
                Console.WriteLine(e.StackTrace);
                Console.WriteLine("There was an error in loading " + this.XmlPath);
                Console.WriteLine("Exiting Now!");
                return null;
            }
        }
    }
}
